<div class="video-call-page">
  <div class="video-call-container">
    <!-- Error -->
    @if (errorMessage()) {
      <div class="error-overlay">
        <div class="error-card">
          <i class="pi pi-exclamation-triangle text-4xl text-orange-intense mb-4"></i>
          <p class="text-gray-700 text-center mb-6">{{ errorMessage() }}</p>
          <button
            pButton
            label="Volver al Dashboard"
            (click)="colgar()"
            class="bg-gradient-orange text-white font-semibold py-2 px-6 rounded-lg"
          ></button>
        </div>
      </div>
    }

    <!-- Cargando -->
    @if (isInitializing() && !errorMessage()) {
      <div class="loading-overlay">
        <div class="text-center">
          <i class="pi pi-spin pi-spinner text-5xl text-white mb-4"></i>
          <p class="text-white text-lg">Iniciando videollamada...</p>
        </div>
      </div>
    }

    <!-- Video remoto (llena el recuadro) -->
    <div class="remote-video-wrapper">
      <div #remoteVideo class="remote-video"></div>

      @if (!agoraService.remoteUser() && agoraService.isJoined()) {
        <div class="waiting-overlay">
          <div class="text-center">
            <i class="pi pi-users text-5xl text-white mb-4"></i>
            <p class="text-white text-lg">Esperando al otro participante...</p>
          </div>
        </div>
      }
    </div>

    <!-- Video local (esquina) - siempre en DOM para que ViewChild funcione -->
    <div class="local-video-wrapper" [class.hidden-wrapper]="!agoraService.isJoined()">
      <div #localVideo class="local-video"></div>
      @if (!agoraService.isCameraOn()) {
        <div class="camera-off-overlay">
          <i class="pi pi-video-off text-white text-2xl"></i>
        </div>
      }
    </div>

    <!-- Controles -->
    @if (agoraService.isJoined()) {
      <div class="controls-bar">
        <button
          class="control-btn"
          [class.control-btn-off]="!agoraService.isMicOn()"
          (click)="toggleMic()"
          title="{{ agoraService.isMicOn() ? 'Silenciar microfono' : 'Activar microfono' }}"
        >
          <i class="pi {{ agoraService.isMicOn() ? 'pi-microphone' : 'pi-microphone-slash' }}"></i>
        </button>

        <button
          class="control-btn"
          [class.control-btn-off]="!agoraService.isCameraOn()"
          (click)="toggleCamera()"
          title="{{ agoraService.isCameraOn() ? 'Apagar camara' : 'Encender camara' }}"
        >
          <i class="pi {{ agoraService.isCameraOn() ? 'pi-video' : 'pi-video-off' }}"></i>
        </button>

        <button
          class="control-btn control-btn-hangup"
          (click)="colgar()"
          title="Colgar"
        >
          <i class="pi pi-phone"></i>
        </button>
      </div>
    }
  </div>
</div>
